package n1exercici1.singletons;


import n1exercici1.sales.Ticket;
import n1exercici1.utils.Constants;

import java.util.ArrayList;
import java.util.List;

<<<<<<< HEAD
import n1exercici1.beans.Ticket;
import n1exercici1.io.FileManager;
import n1exercici1.io.FlowerShopFileReader;
import n1exercici1.io.FlowerShopFileWriter;
import n1exercici1.utils.Constants;

public class TicketSingleton {

	private static TicketSingleton ticketSingleton;
	
	private List<Ticket> ticketsList;
	private int maxAssignedTicketId;
	private static int nextTicketId;
=======
public class TicketSingleton{

private static TicketSingleton ticketSingleton;


	private List<Ticket> ticketsList;
>>>>>>> d2746ab0ea6944f80ded4773fd3769156ed48aaa
	
	private TicketSingleton() {
		super();
		ticketsList = new ArrayList<>();
		if(nextTicketId == 0) {
			nextTicketId = 1;
		}
	}
	
	public static TicketSingleton getTicketSingleton() {
		if(ticketSingleton == null) {
			ticketSingleton = new TicketSingleton();
		}
		return ticketSingleton;
	}
	
	public int getNextTicketId() {
		this.maxAssignedTicketId = nextTicketId;
		nextTicketId++;
		return maxAssignedTicketId;
	}
	
	//assigned from file read
	public void setNextTicketId(int readMaxAssignedTicketId) {
		nextTicketId = readMaxAssignedTicketId;
		nextTicketId++;
	}

<<<<<<< HEAD
	public List<Ticket> getTicketsList() {
		return ticketsList;
	}

	public void setTicketsList(List<Ticket> ticketsList) {
		this.ticketsList = ticketsList;
	}
	
	public void loadSales() {
		FlowerShopFileReader.readSalesFile(Constants.Files.SALES);		
=======
	public List<Ticket> getticketsList() {
		return ticketsList;
	}

	public void setStockList(List<Ticket> ticketsList) {
		this.ticketsList = ticketsList;
	}


	public void addTicket (Ticket ticket){
		ticketsList.add(ticket);

	}

	public void removeTicket(int ticketID) {
		for (Ticket ticket : ticketsList) {
			if (ticket.getTicketID() == ticketID) {
				ticketsList.remove(ticket);
			} else {
				System.out.println(Constants.Messages.ID_NOT_FOUND);
			}
		}
	}

	// l'he fet com si fos accounting del getSalesMenu
	public float totalAmountTickets () {
		float totalAmountTickets = 0.0F;
		for (Ticket ticket:ticketsList){
			totalAmountTickets += ticket.getTotalTicket();
		}
		return totalAmountTickets;
	}


	@Override
	public String toString() {
		return "TicketSingleton [ticketsList=" + ticketsList + "]";
>>>>>>> d2746ab0ea6944f80ded4773fd3769156ed48aaa
	}
	
	public void handleMaxAssignedTicketIdPersitence() {
		
		FileManager.deleteFile(Constants.Files.PATH_CONTROL, Constants.Files.IDS, true);
		
		if(!FileManager.fileExists(Constants.Files.PATH_CONTROL, Constants.Files.IDS)) {
			FileManager.createFile(Constants.Files.PATH_CONTROL, Constants.Files.IDS);
		}
		
		FlowerShopFileWriter.writeIdToFile("ticket:" + maxAssignedTicketId + "\n", Constants.Files.IDS);
		
	}
	
	public void handleSalesPersistence() {
		
		FileManager.deleteFile(Constants.Files.PATH_PERSISTENCE, Constants.Files.SALES, true);
		
		if(ticketsList.isEmpty()) {
			FileManager.createFile(Constants.Files.PATH_PERSISTENCE, Constants.Files.SALES);
		} else {
			for(int i = 0; i < ticketsList.size(); i++) {
				if(ticketsList.size() == 1) {
					FlowerShopFileWriter.writeToJsonFile(ticketsList.get(i), Constants.Files.SALES, true, true);
				} else if(i == 0 && ticketsList.size() > 1) {
					FlowerShopFileWriter.writeToJsonFile(ticketsList.get(i), Constants.Files.SALES, true, false);
				} else if(i == ticketsList.size() - 1 && ticketsList.size() > 1) {
					FlowerShopFileWriter.writeToJsonFile(ticketsList.get(i), Constants.Files.SALES, false, true);
				} else {
					FlowerShopFileWriter.writeToJsonFile(ticketsList.get(i), Constants.Files.SALES, false, false);
				}
			}
		}

	}
}
